<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      /* Style global */
      body {
        font-family: "Arial", sans-serif;
        background-color: #f9f9f9;
        color: #333;
        margin: 0;
        padding: 20px;
      }

      h1 {
        text-align: center;
        color: blue;
        margin-bottom: 20px;
        font-size: 2.5rem;
      }

      ul {
        list-style: none;
        padding: 0;
      }

      li {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      li:hover {
        transform: scale(1.02);
      }

      /* Styles pour les fichiers */
      img,
      video,
      audio,
      iframe {
        max-width: 100%;
        margin-top: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      video,
      audio {
        background-color: #000;
      }

      iframe {
        border: none;
      }

      a {
        display: inline-block;
        margin-top: 10px;
        text-decoration: none;
        color: blue;
        font-weight: bold;
        transition: color 0.2s ease;
      }

      a:hover {
        color: blue;
      }

      /* Style de la liste des fichiers */
      #file-list {
        max-width: 800px;
        margin: 0 auto;
      }

      /* Style des boutons */
      .button-container {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .button {
        background-color: blue;
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 0.9rem;
        cursor: pointer;
        border: none;
        transition: background-color 0.3s ease;
      }

      .button:hover {
        background-color: #0056b3;
      }

      /* Responsive */
      @media (max-width: 600px) {
        h1 {
          font-size: 2rem;
        }

        li {
          padding: 10px;
        }

        .button {
          padding: 6px 10px;
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <h1>Liste des fichiers</h1>
    <ul id="file-list"></ul>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
      import {
        getStorage,
        ref,
        getDownloadURL,
        listAll,
      } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js";
      import {
        getDatabase,
        ref,
        get,
        set,
        onValue,
      } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA5KivS1hhrIufEYwt8T8MN1hguKa3aSMY",
        authDomain: "test-techmine.firebaseapp.com",
        databaseURL:
          "https://test-techmine-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "test-techmine",
        storageBucket: "test-techmine.appspot.com",
        messagingSenderId: "876142620682",
        appId: "1:876142620682:web:5bad29bd4f71d82be6aff3",
        measurementId: "G-2LKJFXNQ58",
      };

      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);
      const db = getDatabase();

      const versionRef = ref(db, "appInfo/version");

      onValue(versionRef, (snapshot) => {
        const latestVersion = snapshot.val();
        const currentVersion = localStorage.getItem("appVersion");
        if (currentVersion != latestVersion) {
          localStorage.setItem("appVersion", latestVersion);
          window.location.reload();
        }
      });
      // Référence du dossier
      const folderRef = ref(storage, "attachments/10046");

      // Liste des fichiers
      const fileListElement = document.getElementById("file-list");

      // Lister et afficher les fichiers
      listAll(folderRef)
        .then((res) => {
          res.items.forEach((itemRef) => {
            getDownloadURL(itemRef).then((url) => {
              const li = document.createElement("li");

              // Détection du type de fichier à partir de l'extension
              const fileName = itemRef.name;
              const fileExtension = fileName.split(".").pop().toLowerCase();

              // Boutons supplémentaires
              const buttonContainer = document.createElement("div");
              buttonContainer.classList.add("button-container");

              if (["jpg", "jpeg", "png", "gif"].includes(fileExtension)) {
                const img = document.createElement("img");
                img.src = url;
                img.style.transition = "transform 0.3s ease";
                let rotation = 0;

                // Bouton pour voir en grand
                const viewButton = document.createElement("button");
                viewButton.textContent = "Voir en grand";
                viewButton.classList.add("button");
                viewButton.onclick = () => {
                  const newWindow = window.open(url, "_blank");
                  newWindow.focus();
                };

                // Bouton pour tourner l'image
                const rotateButton = document.createElement("button");
                rotateButton.textContent = "Tourner";
                rotateButton.classList.add("button");
                rotateButton.onclick = () => {
                  rotation = (rotation + 90) % 360;
                  img.style.transform = `rotate(${rotation}deg)`;
                };

                buttonContainer.appendChild(viewButton);
                buttonContainer.appendChild(rotateButton);

                li.appendChild(img);
              } else if (["mp4", "webm", "ogg"].includes(fileExtension)) {
                const video = document.createElement("video");
                video.src = url;
                video.controls = true;
                li.appendChild(video);
              } else if (["mp3", "wav", "ogg"].includes(fileExtension)) {
                const audio = document.createElement("audio");
                audio.src = url;
                audio.controls = true;
                li.appendChild(audio);
              } else if (fileExtension === "pdf") {
                const iframe = document.createElement("iframe");
                iframe.src = url;
                iframe.width = "100%";
                iframe.height = "500px";
                li.appendChild(iframe);
              }

              li.appendChild(buttonContainer); // Ajouter la div des boutons
              fileListElement.appendChild(li);
            });
          });
        })
        .catch((error) => {
          console.error("Erreur :", error);
        });
    </script>
  </body>
</html>
